generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  directUrl = env("DATABASE_URL_UNPOOLED")
}

// GitHub repository - cached from API
model Repo {
  id          Int      @id
  name        String
  fullName    String   @unique
  description String?
  htmlUrl     String
  homepage    String?
  stars       Int      @default(0)
  forks       Int      @default(0)
  language    String?
  topics      String   @default("[]") // JSON array stored as string
  pushedAt    DateTime
  createdAt   DateTime

  // Admin controls
  hidden      Boolean  @default(false)
  featured    Boolean  @default(false)
  order       Int      @default(0)

  // Override fields (optional, fallback to GitHub data if null)
  customName        String?
  customDescription String?

  updatedAt   DateTime @updatedAt
}

// Site settings
model Settings {
  id               String   @id @default("main")
  lastRefresh      DateTime @default(now())
  availableForWork Boolean  @default(true)
  updatedAt        DateTime @updatedAt
}

// Admin account - single row for site admin
// Password is stored hashed, created on first use via terminal
model Admin {
  id            String   @id @default("main")
  passwordHash  String   // PBKDF2 hash with salt
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

// Cached commit data from GitHub
model Commit {
  sha       String   @id
  message   String
  date      DateTime
  repoName  String
  repoUrl   String
  author    String
  createdAt DateTime @default(now())
}

// AI-generated newspaper content - multiple variants per day allowed
model NewspaperEdition {
  id          String   @id @default(cuid())
  date        DateTime // Multiple editions can share same date (variants)
  headline    String   // Main dramatic headline
  subheadline String   // Secondary headline
  bodyContent String   // Multi-paragraph body (stored as JSON array)
  pullQuote   String   // Featured quote
  isActive    Boolean  @default(false) // Only one active per day, shown to visitors
  isFallback  Boolean  @default(false) // True if this is default content
  generatedBy String?  // "gemini-2.5-flash" or null for fallback
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([date]) // Index for querying by date
}

// Cached GitHub activity events
model Activity {
  id        String   @id
  type      String   // create, release, pr, star, fork
  title     String
  repoName  String
  repoUrl   String
  date      DateTime
  createdAt DateTime @default(now())

  @@index([date])
}

